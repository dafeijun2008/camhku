var $runame=$(".form>.register .uname");var $luname=$(".form>.login .uname");var $lupwd=$(".form>.login .upwd");$runame.blur(function(){loseBlur($(this),"data/register.php",{uname:$(this).val()},"请输入3-10个字符")});$luname.blur(function(){loseBlur($(this),"data/login_uname.php",{uname:$(this).val()},"用户名不正确,请重新输入")});$lupwd.blur(function(){loseBlur($(this),"data/login_upwd.php",{uname:$luname.val(),upwd:$(this).val()},"密码错误,请重新输入")});function loseBlur(b,d,c,a){if(b.next().attr("class")==="vali_success"){$.ajax({type:"post",url:d,data:c,success:function(e){if(e.code==1){b.next().attr("class","vali_fail")}else{b.next().attr("class","vali_success")}b.next().html(e.msg)},error:function(e){console.log("响应出错")}})}else{b.next().html(a)}}$(".form>.register .btn").click(function(){subm($(this),"data/register_add_do.php")});$(".form>.login .btn").click(function(){subm($(this),"data/login.php")});function subm(a,g){var d=a.parent().parent().children(":first").children().eq(2).attr("class")==="vali_success";var c=a.parent().parent().children(":nth-child(2)").children().eq(2).attr("class")==="vali_success";var f=a.parent().parent().children(":nth-child(3)").children().eq(2).attr("class")==="vali_success";var b=a.parent().parent().children(":first").children().eq(1);var e=a.parent().parent().children(":nth-child(2)").children().eq(1);if(d&&c&&f){$.ajax({type:"post",url:g,data:{uname:b.val(),upwd:e.val()},success:function(h){console.log(h.name);if(h.code==1){window.location.href="../index.html";sessionStorage.userId=h.uid;sessionStorage.uname=h.uname}},error:function(h){console.log("响应出错"+h)}})}else{a.click=null}}function parseSearch(){if(location.search!=""){var a=location.search.slice(1).split("&");for(var c=0,d={}; c<a.length; c++){var b=a[c].split("=");d[b[0]]=b[1]}return d}else{return{}}}var obj=parseSearch().user;var login=$(".login");var register=$(".register");if(obj=="login"){console.log(1);$("#section>.form>.section_top").children(":last").addClass("bg_color").siblings().removeClass("bg_color");login.removeClass("hidden").prev().addClass("hidden")}else{if(obj=="register"){console.log(2);$("#section>.form>.section_top").children(":first").addClass("bg_color").siblings().removeClass("bg_color");register.removeClass("hidden").next().addClass("hidden")}}$("#section>.form>.section_top").on("click","span",function(){$(this).addClass("bg_color").siblings().removeClass("bg_color");if($(this).html()==="注册"){register.removeClass("hidden").next().addClass("hidden")}else{if($(this).html()==="登录"){login.removeClass("hidden").prev().addClass("hidden")}}});